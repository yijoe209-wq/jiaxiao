# 家校任务助手 - 产品功能流程图

## 🎯 角色定义

### 主要角色
1. **家长** - 主要用户，管理孩子的学习任务
2. **学生** - 任务的执行者（未来规划）
3. **系统** - AI 智能解析和自动化处理

---

## 📊 核心业务流程图

### 1. 用户注册与登录流程

```mermaid
graph TD
    A[访问应用] --> B{已注册?}
    B -->|否| C[注册页面]
    B -->|是| D[登录页面]

    C --> E[填写家长姓名]
    E --> F[填写邮箱]
    F --> G[设置密码]
    G --> H[提交注册]
    H --> I[自动登录]

    D --> J[输入邮箱/密码]
    J --> K[提交登录]

    I --> L{选择跳转}
    K --> L

    L -->|添加学生| M[首页/]
    L -->|查看任务| N[任务中心/my-tasks]
    L -->|学生管理| O[学生页/students]

    style A fill:#e1f5ff
    style N fill:#c8e6c9
    style M fill:#fff9c6
    style O fill:#ffccbc
```

---

### 2. 首次使用流程（添加学生）

```mermaid
graph TD
    A[登录后] --> B[跳转到首页]
    B --> C{有学生?}

    C -->|否| D[显示添加学生引导]
    C -->|是| E[显示现有学生列表]

    D --> F[点击"添加学生"按钮]
    F --> G[打开添加学生模态框]

    G --> H[输入学生姓名]
    H --> I[选择年级]
    I --> J[可选: 输入班级]

    J --> K[提交表单]
    K --> L[学生添加成功]
    L --> M[刷新学生下拉列表]

    E --> N[可以选择现有学生]
    N --> O[准备创建任务]

    M --> O
    O --> P[✅ 学生管理完成]

    style A fill:#e1f5ff
    style P fill:#c8e6c9
    style G fill:#fff9c6
```

---

### 3. 创建任务主流程

```mermaid
graph TD
    A[首页 - 创建任务] --> B[选择学生]
    B --> C[输入作业内容/上传图片]
    C --> D[点击"AI 智能解析"]

    D --> E{AI 解析}
    E -->|成功| F[跳转到确认页面]
    E -->|失败| G[显示错误提示]

    G --> H[修改输入内容]
    H --> C

    F --> I[确认页面]
    I --> J[显示解析结果]
    J --> K[编辑任务信息]

    K --> L[修改科目标签]
    K --> M[修改截止日期]
    K --> N[修改任务描述]

    L --> O[点击"确认创建任务"]
    M --> O
    N --> O

    O --> P{创建成功?}
    P -->|是| Q[显示成功提示弹窗]
    P -->|否| R[显示错误信息]

    R --> S[返回修改]
    S --> I

    Q --> T{用户选择}
    T -->|查看任务| U[3秒自动跳转]
    T -->|继续添加| V[点击按钮返回首页]
    T -->|等待倒计时| U

    U --> W[任务中心 /my-tasks]
    V --> A

    W --> X[✅ 任务创建完成]

    style A fill:#e1f5ff
    style X fill:#c8e6c9
    style Q fill:#fff9c6
    style F fill:#e8f5e9
```

---

### 4. 任务中心管理流程

```mermaid
graph TD
    A[任务中心 /my-tasks] --> B[加载任务列表]
    B --> C[显示统计卡片]

    C --> D[紧急任务]
    C --> E[警告任务]
    C --> F[待完成任务]
    C --> G[全部任务数]

    D --> H[筛选选项]
    E --> H
    F --> H
    G --> H

    H --> I[按学生筛选]
    H --> J[按科目筛选]
    H --> K[按状态筛选]
    H --> L[快捷筛选]

    L --> M[今天要完成]
    L --> N[本周任务]
    L --> O[已逾期]
    L --> P[待完成]

    I --> Q[显示筛选后的任务列表]
    J --> Q
    K --> Q
    M --> Q
    N --> Q
    O --> Q
    P --> Q

    Q --> R{任务操作}

    R -->|查看附件| S[点击附件缩略图]
    R -->|编辑任务| T[点击编辑按钮]
    R -->|标记完成| U[点击完成按钮]

    S --> AA[附件预览功能 - 详见流程6]
    T --> BB[任务编辑功能 - 详见流程7]
    U --> V[更新任务状态]
    V --> W[任务显示为已完成]

    W --> X[✅ 任务管理完成]

    style A fill:#e1f5ff
    style X fill:#c8e6c9
    style S fill:#e8f5e9
    style T fill:#fff9c6
```

---

### 5. 学生管理流程

```mermaid
graph TD
    A[学生管理页 /students] --> B[加载学生列表]
    B --> C{有学生?}

    C -->|否| D[显示"暂无学生"提示]
    C -->|是| E[显示学生卡片列表]

    D --> F[添加学生]

    E --> G{学生操作}
    G -->|编辑| H[点击编辑按钮]
    G -->|删除| I[点击删除按钮]

    F --> J[打开添加学生表单]
    J --> K[输入学生信息]
    K --> L[提交添加]
    L --> M[✅ 添加成功]

    H --> N[打开编辑模态框]
    N --> O[修改学生信息]
    O --> P[保存修改]
    P --> Q[✅ 更新成功]

    I --> R[显示确认对话框]
    R --> S{确认删除?}
    S -->|取消| T[返回]
    S -->|确认| U[调用删除 API]
    U --> V[✅ 删除成功]

    M --> W[刷新列表]
    Q --> W
    V --> W
    T --> W

    W --> X[✅ 学生管理完成]

    style A fill:#e1f5ff
    style X fill:#c8e6c9
    style M fill:#e8f5e9
    style Q fill:#e8f5e9
    style V fill:#e8f5e9
```

---

### 6. 附件预览功能流程

```mermaid
graph TD
    A[任务中心] --> B[显示任务卡片]
    B --> C[任务有附件?]

    C -->|是| D[显示附件缩略图]
    C -->|否| E[不显示附件区域]

    D --> F[鼠标悬停缩略图]
    F --> G[显示放大镜图标]

    G --> H[点击缩略图]
    H --> I[打开预览模态框]

    I --> J[显示大图]
    I --> K[显示图片计数器]
    I --> L[显示导航按钮]
    I --> M[显示下载按钮]

    L --> N{用户操作}
    N -->|上一张| O[点击左箭头]
    N -->|下一张| P[点击右箭头]
    N -->|键盘←| Q[上一张]
    N -->|键盘→| R[下一张]
    N -->|ESC| S[关闭模态框]
    N -->|点击外部| S
    N -->|点击×| S

    N -->|下载| T[点击下载按钮]
    T --> U[浏览器下载附件]

    O --> V[更新大图]
    P --> V
    Q --> V
    R --> V

    V --> W[✅ 附件浏览完成]
    S --> W

    style A fill:#e1f5ff
    style W fill:#c8e6c9
    style I fill:#fff9c6
```

---

### 7. 任务编辑功能流程

```mermaid
graph TD
    A[任务中心] --> B[显示任务卡片]
    B --> C[每个任务有编辑按钮]

    C --> D[点击蓝色编辑按钮]
    D --> E[打开编辑模态框]

    E --> F[加载任务数据]
    F --> G[填充任务描述]
    F --> H[填充科目选择]
    F --> I[填充截止日期]
    F --> J[显示附件信息]

    G --> K{用户编辑}
    H --> K
    I --> K

    K --> L[修改内容]
    L --> M{用户操作}
    M -->|取消| N[关闭模态框]
    M -->|保存| O[验证输入]

    O --> P{描述为空?}
    P -->|是| Q[提示错误]
    P -->|否| R[调用更新 API]

    Q --> K

    R --> S{更新成功?}
    S -->|是| T[关闭模态框]
    S -->|否| U[显示错误信息]

    T --> V[刷新任务列表]
    V --> W[显示更新后的任务]

    U --> K
    N --> X[✅ 取消编辑]
    W --> Y[✅ 编辑成功]

    style A fill:#e1f5ff
    style Y fill:#c8e6c9
    style E fill:#fff9c6
```

---

## 🔄 完整用户旅程地图

### 场景 1: 首次使用 → 创建第一个任务

```mermaid
graph LR
    A[首次访问] --> B[注册账号]
    B --> C[自动登录]
    C --> D[添加第一个学生]
    D --> E[上传作业图片]
    E --> F[AI 智能解析]
    F --> G[确认任务信息]
    G --> H[创建成功]
    H --> I[查看任务列表]

    style A fill:#e1f5ff
    style I fill:#c8e6c9
```

### 场景 2: 日常使用 - 管理任务

```mermaid
graph LR
    A[打开应用] --> B[查看今日任务]
    B --> C[标记完成任务]
    C --> D[编辑任务信息]
    D --> E[添加新任务]
    E --> F[管理学生信息]

    style A fill:#e1f5ff
    style F fill:#c8e6c9
```

### 场景 3: 附件预览与下载

```mermaid
graph LR
    A[查看任务] --> B[看到附件缩略图]
    B --> C[点击预览]
    C --> D[浏览多张图片]
    D --> E[下载附件]

    style A fill:#e1f5ff
    style E fill:#c8e6c9
```

---

## 📱 页面导航图

```mermaid
graph TD
    A[登录/注册<br>/login] --> B[首页<br>/]
    A --> C[任务中心<br>/my-tasks]
    A --> D[学生管理<br>/students]
    A --> E[任务列表<br>/tasks]

    B --> F{AI解析}
    F --> G[确认页面<br>/confirm]
    G --> H[成功提示]
    H --> C

    C --> I[筛选任务]
    C --> J[编辑任务]
    C --> K[标记完成]
    C --> L[预览附件]

    D --> M[添加学生]
    D --> N[编辑学生]
    D --> O[删除学生]

    E --> P[待确认任务]
    E --> Q[已确认任务]

    style A fill:#ffccbc
    style B fill:#fff9c6
    style C fill:#c8e6c9
    style D fill:#e1f5ff
    style E fill:#f3e5f5
    style G fill:#fff9c6
```

---

## 🎨 功能模块关系图

```mermaid
graph TD
    A[家校任务助手] --> B[用户认证模块]
    A --> C[任务管理模块]
    A --> D[学生管理模块]
    A --> E[AI 解析模块]

    B --> B1[注册]
    B --> B2[登录]
    B --> B3[权限验证]

    C --> C1[创建任务]
    C --> C2[查看任务]
    C --> C3[编辑任务]
    C --> C4[标记完成]
    C --> C5[附件预览]

    D --> D1[添加学生]
    D --> D2[编辑学生]
    D --> D3[删除学生]
    D --> D4[学生列表]

    E --> E1[智能解析]
    E --> E2[科目识别]
    E --> E3[任务提取]
    E --> E4[截止日期识别]

    C5 --> F[图片处理]
    F --> F1[缩略图显示]
    F --> F2[大图预览]
    F --> F3[多图浏览]
    F --> F4[图片下载]

    style A fill:#667eea
    style C fill:#c8e6c9
    style D fill:#64b5f6
    style E fill:#ffb74d
    style F fill:#81c784
```

---

## 📊 数据流向图

```mermaid
graph TD
    A[用户输入<br>任务内容+图片] --> B[AI 解析模块]
    B --> C[解析结果<br>pending_tasks]
    C --> D[用户确认<br>confirm 页面]
    D --> E[编辑后的数据]
    E --> F[正式任务<br>tasks 表]

    F --> G[任务中心<br>my-tasks]
    G --> H[用户查看]
    H --> I[用户操作]

    I --> J[编辑任务]
    I --> K[标记完成]
    I --> L[预览附件]

    J --> M[更新任务<br>tasks 表]
    K --> M
    L --> N[读取附件<br>从 tasks]

    M --> G

    O[学生数据<br>students] --> P[学生管理页]
    P --> Q[用户操作]
    Q --> R[添加/编辑/删除]
    R --> O

    style A fill:#e1f5ff
    style B fill:#fff9c6
    style F fill:#c8e6c9
    style M fill:#c8e6c9
    style O fill:#ffccbc
```

---

## 🔐 权限与数据隔离

```mermaid
graph TD
    A[用户请求] --> B[验证 Family ID]
    B --> C{Family ID 有效?}

    C -->|否| D[返回 401 未授权]
    C -->|是| E[检查数据所有权]

    E --> F{数据属于该家庭?}
    F -->|否| G[返回 403 禁止访问]
    F -->|是| H[允许操作]

    H --> I[读取数据]
    H --> J[修改数据]
    H --> K[删除数据]

    I --> L[返回数据]
    J --> M[更新成功]
    K --> N[删除成功]

    L --> O[✅ 操作完成]
    M --> O
    N --> O

    style A fill:#e1f5ff
    style D fill:#ef5350
    style G fill:#ef5350
    style O fill:#c8e6c9
```

---

## 📈 用户使用路径

### 新用户第一周使用路径

```
Day 1: 注册 → 添加学生 → 创建第一个任务
Day 2: 查看任务 → 标记完成 → 添加新任务
Day 3: 编辑任务信息 → 管理学生 → 附件预览
Day 4: 批量创建任务 → 使用筛选功能
Day 5: 完善任务标签 → 调整截止日期
Day 6: 删除过期任务 → 添加第二个学生
Day 7: 完整使用所有功能
```

---

## 🎯 核心功能总结

### ✅ 已实现功能
1. 用户注册与登录
2. 学生管理（CRUD）
3. 任务创建（AI 解析）
4. 任务确认与编辑
5. 任务列表查看
6. 任务筛选（学生、科目、状态）
7. 任务完成标记
8. 任务编辑功能
9. 附件上传与预览
10. 附件下载
11. 成功提示与页面跳转

### 🚧 待实现功能
1. 任务通知提醒
2. 统计分析页面
3. 任务分享功能
4. 学生独立端
5. 暗黑模式
6. 批量操作
7. 快捷键支持

---

**文档版本**: v2.0
**最后更新**: 2026-01-14
**包含流程**: 7个核心流程 + 完整用户旅程
