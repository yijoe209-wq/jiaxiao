# 测试准备清单

**测试时间**: 10 分钟后等待部署完成
**测试目标**: 验证 https://edu-track.zeabur.app 所有功能正常

---

## ✅ 已完成的工作

### 1. 代码修复
- [x] 修复 PostgreSQL 驱动兼容性 (commit 6511d8b)
- [x] 修复数据库表自动创建 (commit da734cc)
- [x] 代码已推送到 GitHub

### 2. 测试文档
- [x] [TEST_SCENARIOS.md](TEST_SCENARIOS.md) - 完整的用户操作测试场景
- [x] [TEST_GUIDE.md](TEST_GUIDE.md) - Playwright 测试指南
- [x] [tests_e2e.py](tests_e2e.py) - 自动化测试脚本
- [x] [run_tests.sh](run_tests.sh) - 测试启动脚本
- [x] [requirements-test.txt](requirements-test.txt) - 测试依赖

---

## 📋 10 分钟后执行以下步骤

### Step 1: 确认 Zeabur 部署状态

1. 访问 Zeabur 控制台
2. 检查部署状态是否为 "Running"
3. 查看部署日志，确认没有错误

**预期结果**:
- ✅ 部署状态: Running
- ✅ 日志显示: "✅ 数据库表创建成功"
- ✅ 无错误信息

### Step 2: 手动快速验证

在运行自动化测试前，先手动验证基本功能：

1. **访问登录页面**
   ```
   URL: https://edu-track.zeabur.app/login
   ```
   - [ ] 页面正常加载
   - [ ] 显示登录/注册表单
   - [ ] 无数据库错误

2. **尝试注册新用户**
   ```
   邮箱: test@example.com
   密码: test123456
   姓名: 测试用户
   ```
   - [ ] 注册成功
   - [ ] 自动登录
   - [ ] 跳转到首页

3. **查看任务中心**
   ```
   URL: https://edu-track.zeabur.app/
   ```
   - [ ] 页面正常加载
   - [ ] 显示"暂无任务"或任务列表
   - [ ] 左侧显示学生筛选器

如果以上基本功能正常，继续下一步。

### Step 3: 安装测试依赖

```bash
# 安装 Python 依赖
pip install -r requirements-test.txt

# 安装 Playwright 浏览器
playwright install chromium

# 验证安装
playwright --version
```

**预期输出**:
```
Playwright Version: 1.40.x
```

### Step 4: 运行自动化测试

#### 方法 1: 使用启动脚本（推荐）

```bash
./run_tests.sh
```

#### 方法 2: 直接运行

```bash
python tests_e2e.py
```

#### 方法 3: 使用 pytest

```bash
# 显示浏览器窗口
pytest tests_e2e.py -v --headed

# 无头模式
pytest tests_e2e.py -v
```

### Step 5: 查看测试结果

**控制台输出**:
- ✅ 每个场景的执行状态
- ✅ API 响应状态码
- ✅ 验证结果（成功/失败）

**截图文件**:
- `test_screenshot_after_register_*.png`
- `test_screenshot_after_add_student_*.png`
- `test_screenshot_after_parse_*.png`
- `test_screenshot_task_center_*.png`
- `test_screenshot_after_complete_*.png`
- `test_screenshot_after_multi_parse_*.png`
- `test_screenshot_after_logout_*.png`

### Step 6: 分析测试结果

#### 如果所有测试通过 ✅

恭喜！应用功能完全正常。

**后续工作**:
- [ ] 清理测试数据（可选）
- [ ] 通知用户可以正常使用
- [ ] 准备生产环境发布

#### 如果有测试失败 ❌

查看失败的截图和日志，分析问题：

**常见问题**:

1. **页面元素找不到**
   - 原因: HTML 结构变化
   - 解决: 更新选择器

2. **API 返回错误**
   - 原因: 后端逻辑问题
   - 解决: 查看 Zeabur 日志，修复代码

3. **数据库错误**
   - 原因: 表未创建或数据不匹配
   - 解决: 检查数据库初始化

4. **AI 解析超时**
   - 原因: LLM API 响应慢
   - 解决: 增加等待时间

---

## 🧪 测试场景详细清单

### 场景 1: 新用户注册和首次使用

**测试步骤**:
- [ ] 访问 /login
- [ ] 切换到注册标签
- [ ] 填写注册信息
- [ ] 提交注册
- [ ] 验证自动登录
- [ ] 验证跳转到首页

**验证点**:
- [ ] 注册 API 返回 200
- [ ] 自动设置 session
- [ ] 页面跳转正确

### 场景 3: 添加学生信息

**测试步骤**:
- [ ] 访问 /students
- [ ] 点击添加学生
- [ ] 填写学生信息
- [ ] 提交表单
- [ ] 验证学生显示

**验证点**:
- [ ] 添加学生 API 返回 200
- [ ] 学生列表更新
- [ ] 学生信息正确

### 场景 4: 快速添加任务（AI 解析）

**测试步骤**:
- [ ] 访问 /add
- [ ] 输入作业消息
- [ ] 点击 AI 解析
- [ ] 等待解析完成
- [ ] 查看任务预览
- [ ] 选择学生
- [ ] 确认创建
- [ ] 验证跳转到任务中心

**验证点**:
- [ ] AI 解析 API 正常
- [ ] 任务预览正确
- [ ] 任务创建成功
- [ ] 任务中心显示新任务

### 场景 5: 任务中心管理

**测试步骤**:
- [ ] 访问 /
- [ ] 查看任务列表
- [ ] 检查筛选功能
- [ ] 查看任务统计

**验证点**:
- [ ] 任务列表正确
- [ ] 筛选器工作正常
- [ ] 统计数据准确

### 场景 6: 完成和编辑任务

**测试步骤**:
- [ ] 访问任务中心
- [ ] 点击完成按钮
- [ ] 验证状态更新
- [ ] 查看任务样式变化

**验证点**:
- [ ] 完成 API 返回 200
- [ ] 任务状态更新
- [ ] UI 反馈正确

### 场景 7: 多任务批量确认

**测试步骤**:
- [ ] 访问 /add
- [ ] 输入多科目作业
- [ ] 点击 AI 解析
- [ ] 等待解析完成
- [ ] 查看任务列表
- [ ] 确认创建所有任务
- [ ] 验证批量创建成功

**验证点**:
- [ ] 解析出 10 条任务
- [ ] 任务预览正确
- [ ] 批量创建成功
- [ ] 所有任务出现在列表

### 场景 9: 退出登录

**测试步骤**:
- [ ] 访问 /logout
- [ ] 验证跳转到登录页
- [ ] 尝试访问受保护页面
- [ ] 验证重定向到登录页

**验证点**:
- [ ] Session 已清除
- [ ] 重定向正确
- [ ] 无法访问受保护页面

---

## 📊 预期测试结果

### 成功标准

- ✅ 所有 7 个场景通过
- ✅ 无 API 错误（4xx/5xx）
- ✅ 所有截图正常
- ✅ 总耗时 < 90 秒

### 可接受的警告

- ⚠️ AI 解析时间较长（> 15秒）
- ⚠️ 页面加载稍慢（> 2秒）
- ⚠️ 个别选择器需要微调

### 失败标准

- ❌ 注册/登录失败
- ❌ 数据库错误
- ❌ API 500 错误
- ❌ 页面无法访问
- ❌ 关键功能不可用

---

## 🔧 问题处理流程

### 1. 记录问题
```bash
# 查看截图
open test_screenshot_*.png

# 查看控制台输出
# 从测试运行的输出中复制错误信息
```

### 2. 分析问题
```bash
# 查看 Zeabur 日志
# 在 Zeabur 控制台查看实时日志

# 检查数据库
# 在 Zeabur 数据库控制台查询
```

### 3. 修复问题
```bash
# 修改代码
vim <file>

# 测试修复
git add .
git commit -m "fix: 修复测试发现的问题"
git push origin main
```

### 4. 重新测试
```bash
# 等待部署完成（1-2分钟）
# 再次运行测试
./run_tests.sh
```

---

## 📝 测试报告模板

测试完成后，填写此报告：

```
# 家校任务管理助手 E2E 测试报告

**测试日期**: 2026-01-16
**测试环境**: https://edu-track.zeabur.app
**测试人员**: [你的名字]

## 测试结果总结

- 总场景数: 7
- 通过: [数字]
- 失败: [数字]
- 通过率: [百分比]%

## 详细结果

### 场景 1: 新用户注册和首次使用
- 状态: ✅/❌
- 备注: [描述]

### 场景 3: 添加学生信息
- 状态: ✅/❌
- 备注: [描述]

### 场景 4: 快速添加任务（AI 解析）
- 状态: ✅/❌
- 备注: [描述]

### 场景 5: 任务中心管理
- 状态: ✅/❌
- 备注: [描述]

### 场景 6: 完成和编辑任务
- 状态: ✅/❌
- 备注: [描述]

### 场景 7: 多任务批量确认
- 状态: ✅/❌
- 备注: [描述]

### 场景 9: 退出登录
- 状态: ✅/❌
- 备注: [描述]

## 发现的问题

1. [问题描述]
   - 严重程度: 高/中/低
   - 复现步骤: [步骤]
   - 截图: [文件名]

## 建议和改进

[你的建议]

## 总体评价

[总体评价]
```

---

## 🎯 下一步行动

10 分钟后:

1. ✅ 确认 Zeabur 部署完成
2. ✅ 运行 `./run_tests.sh`
3. ✅ 查看测试结果
4. ✅ 分析问题（如有）
5. ✅ 修复并重新测试

---

**准备完成时间**: 2026-01-16
**计划测试时间**: 10 分钟后
**预计完成时间**: 15 分钟后
