<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶æ ¡ä»»åŠ¡ç®¡ç†åŠ©æ‰‹ - API æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .status {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .status-item {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .status-item h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .status-item p {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .status-ok {
            color: #10b981 !important;
        }

        .status-error {
            color: #ef4444 !important;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .result.show {
            display: block;
        }

        .result h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .result pre {
            background: #1e293b;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
        }

        .student-list {
            margin-bottom: 20px;
        }

        .student-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .student-item:hover {
            background: #e9ecef;
        }

        .student-item.selected {
            background: #667eea;
            color: white;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ å®¶æ ¡ä»»åŠ¡ç®¡ç†åŠ©æ‰‹</h1>
            <p>API æµ‹è¯•æ§åˆ¶å°</p>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€ -->
        <div class="card">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
            <div class="status">
                <div class="status-item">
                    <h3>API æœåŠ¡</h3>
                    <p id="api-status">æ£€æŸ¥ä¸­...</p>
                </div>
                <div class="status-item">
                    <h3>æ•°æ®åº“</h3>
                    <p id="db-status">æ£€æŸ¥ä¸­...</p>
                </div>
                <div class="status-item">
                    <h3>LLM æ¨¡å‹</h3>
                    <p id="llm-status">æ£€æŸ¥ä¸­...</p>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½é€‰é¡¹å¡ -->
        <div class="card">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('test-parse')">ğŸ“ æµ‹è¯•è§£æ</button>
                <button class="tab" onclick="switchTab('view-tasks')">ğŸ“‹ æŸ¥çœ‹ä»»åŠ¡</button>
                <button class="tab" onclick="switchTab('metrics')">ğŸ“ˆ ç³»ç»ŸæŒ‡æ ‡</button>
            </div>

            <!-- æµ‹è¯•è§£æ -->
            <div id="test-parse" class="tab-content active">
                <h2>æµ‹è¯• LLM è§£æ</h2>
                <div class="form-group">
                    <label>è¾“å…¥æµ‹è¯•æ¶ˆæ¯ï¼š</label>
                    <textarea id="test-message" placeholder="ä¾‹å¦‚ï¼šæ˜å¤©è¯·èƒŒè¯µã€Šå±±è¡Œã€‹ï¼Œå¹¶æŠ„å†™ä¸‰é"></textarea>
                </div>
                <button class="btn" onclick="testParse()">ğŸš€ è§£ææ¶ˆæ¯</button>
                <div class="loading" id="parse-loading">
                    <div class="spinner"></div>
                    <p>AI æ­£åœ¨è§£æä¸­...</p>
                </div>
                <div class="result" id="parse-result">
                    <h3>è§£æç»“æœï¼š</h3>
                    <pre id="parse-output"></pre>
                </div>
            </div>

            <!-- æŸ¥çœ‹ä»»åŠ¡ -->
            <div id="view-tasks" class="tab-content">
                <h2>æŸ¥çœ‹å­¦ç”Ÿä»»åŠ¡</h2>
                <div class="form-group">
                    <label>é€‰æ‹©å­¦ç”Ÿï¼š</label>
                    <div class="student-list" id="student-list">
                        <!-- å­¦ç”Ÿåˆ—è¡¨å°†åŠ¨æ€åŠ è½½ -->
                    </div>
                </div>
                <div class="result" id="tasks-result">
                    <h3>ä»»åŠ¡åˆ—è¡¨ï¼š</h3>
                    <pre id="tasks-output"></pre>
                </div>
            </div>

            <!-- ç³»ç»ŸæŒ‡æ ‡ -->
            <div id="metrics" class="tab-content">
                <h2>ç³»ç»ŸæŒ‡æ ‡</h2>
                <button class="btn" onclick="loadMetrics()">ğŸ”„ åˆ·æ–°æŒ‡æ ‡</button>
                <div class="result" id="metrics-result">
                    <h3>æŒ‡æ ‡æ•°æ®ï¼š</h3>
                    <pre id="metrics-output"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5001';

        // æµ‹è¯•å­¦ç”Ÿæ•°æ®
        const students = [
            { id: '704d76e9-9c8b-485e-84a2-5728b2ecbcdb', name: 'å°æ˜', grade: 'ä¸‰å¹´çº§' },
            { id: 'f88ead9b-c640-4904-a44c-f875ec526409', name: 'å°çº¢', grade: 'ä¸€å¹´çº§' }
        ];

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.onload = function() {
            checkHealth();
            loadStudents();
        };

        // æ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶æ€
        async function checkHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();

                document.getElementById('api-status').innerHTML =
                    `<span class="status-ok">âœ“ æ­£å¸¸</span>`;
                document.getElementById('api-status').className = 'status-ok';

                document.getElementById('db-status').innerHTML =
                    data.checks.database === 'ok'
                        ? `<span class="status-ok">âœ“ æ­£å¸¸</span>`
                        : `<span class="status-error">âœ— å¼‚å¸¸</span>`;

                document.getElementById('llm-status').innerHTML =
                    data.checks.llm_api === 'configured'
                        ? `<span class="status-ok">âœ“ å·²é…ç½®</span>`
                        : `<span class="status-error">âœ— æœªé…ç½®</span>`;
            } catch (error) {
                document.getElementById('api-status').innerHTML =
                    `<span class="status-error">âœ— æ— æ³•è¿æ¥</span>`;
                document.getElementById('api-status').className = 'status-error';
            }
        }

        // åŠ è½½å­¦ç”Ÿåˆ—è¡¨
        function loadStudents() {
            const container = document.getElementById('student-list');
            container.innerHTML = students.map(s => `
                <div class="student-item" onclick="selectStudent('${s.id}', '${s.name}')">
                    <strong>${s.name}</strong> (${s.grade})
                    <br><small style="color: #666;">ID: ${s.id.substring(0, 20)}...</small>
                </div>
            `).join('');
        }

        // é€‰æ‹©å­¦ç”Ÿ
        async function selectStudent(studentId, studentName) {
            try {
                const response = await fetch(`${API_BASE}/api/tasks/${studentId}`);
                const data = await response.json();

                const resultDiv = document.getElementById('tasks-result');
                const outputDiv = document.getElementById('tasks-output');

                resultDiv.classList.add('show');
                outputDiv.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                alert('è·å–ä»»åŠ¡å¤±è´¥ï¼š' + error.message);
            }
        }

        // æµ‹è¯•è§£æ
        async function testParse() {
            const message = document.getElementById('test-message').value.trim();
            if (!message) {
                alert('è¯·è¾“å…¥æµ‹è¯•æ¶ˆæ¯');
                return;
            }

            const loading = document.getElementById('parse-loading');
            const result = document.getElementById('parse-result');
            const output = document.getElementById('parse-output');

            loading.classList.add('show');
            result.classList.remove('show');

            try {
                // æ¨¡æ‹Ÿè§£æç»“æœï¼ˆå› ä¸ºéœ€è¦åç«¯æ¥å£ï¼‰
                await new Promise(resolve => setTimeout(resolve, 1500));

                const mockResult = {
                    intent: 'assignment',
                    subject: 'è¯­æ–‡',
                    deadline: null,
                    description: 'èƒŒè¯µã€Šå±±è¡Œã€‹å¹¶æŠ„å†™ä¸‰é',
                    confidence: 0.9,
                    need_confirm: true,
                    raw_text: message
                };

                loading.classList.remove('show');
                result.classList.add('show');
                output.textContent = JSON.stringify(mockResult, null, 2);
            } catch (error) {
                loading.classList.remove('show');
                alert('è§£æå¤±è´¥ï¼š' + error.message);
            }
        }

        // åŠ è½½ç³»ç»ŸæŒ‡æ ‡
        async function loadMetrics() {
            try {
                const response = await fetch(`${API_BASE}/metrics`);
                const data = await response.json();

                const result = document.getElementById('metrics-result');
                const output = document.getElementById('metrics-output');

                result.classList.add('show');
                output.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                alert('è·å–æŒ‡æ ‡å¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆ‡æ¢é€‰é¡¹å¡
        function switchTab(tabId) {
            // éšè—æ‰€æœ‰å†…å®¹
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(el => {
                el.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
