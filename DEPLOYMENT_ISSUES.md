# Zeabur éƒ¨ç½²é—®é¢˜è¯Šæ–­

**æ—¥æœŸ**: 2026-01-16
**çŠ¶æ€**: âš ï¸ ä»£ç æœªéƒ¨ç½²
**æœ€æ–°æäº¤**: a9b5d1f

---

## ğŸš¨ é—®é¢˜æè¿°

### ç—‡çŠ¶

- API è¿”å›é”™è¯¯ï¼š`sqlite3.OperationalError: no such table: families`
- æ•°æ®åº“è¡¨æœªåˆ›å»º
- æ³¨å†Œã€ç™»å½•ç­‰åŠŸèƒ½æ— æ³•ä½¿ç”¨

### æµ‹è¯•å‘½ä»¤

```bash
curl -X POST https://edu-track.zeabur.app/api/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test123456","parent_name":"Test"}'
```

**é¢„æœŸç»“æœ**:
- 200 OK - æ³¨å†ŒæˆåŠŸ
- æˆ– 400 - é‚®ç®±å·²å­˜åœ¨

**å®é™…ç»“æœ**:
- 500 Internal Server Error
- `no such table: families`

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### 1. ä»£ç ä¿®å¤å·²å®Œæˆ

GitHub ä¸Šçš„æœ€æ–°ä»£ç ï¼ˆcommit `da734cc` å’Œ `a9b5d1f`ï¼‰åŒ…å«ä»¥ä¸‹ä¿®å¤ï¼š

**models.py:247-255**
```python
def init_db(database_url=None):
    """åˆå§‹åŒ–æ•°æ®åº“"""
    global db
    if database_url:
        db = Database(database_url)

    # æ€»æ˜¯åˆ›å»ºè¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
    db.create_tables()  # ğŸ‘ˆ å…³é”®ä¿®å¤
    return db
```

### 2. Zeabur æœªéƒ¨ç½²æœ€æ–°ä»£ç 

è¯æ®ï¼š

```bash
# æœ€æ–°æäº¤
$ git log --oneline -1
a9b5d1f trigger: å¼ºåˆ¶è§¦å‘ Zeabur é‡æ–°éƒ¨ç½²ä»¥åº”ç”¨æ•°æ®åº“ä¿®å¤

# ä½† Zeabur ä¸Šçš„ä»£ç ä»ç„¶æŠ¥é”™
$ curl https://edu-track.zeabur.app/api/register
{"error":"no such table: families"}
```

è¿™è¯´æ˜ï¼š
- âœ… ä»£ç å·²æ¨é€åˆ° GitHub
- âŒ Zeabur è¿˜åœ¨ä½¿ç”¨æ—§ä»£ç 
- âŒ Zeabur è‡ªåŠ¨éƒ¨ç½²å¯èƒ½æœªè§¦å‘

---

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: åœ¨ Zeabur æ§åˆ¶å°æ‰‹åŠ¨é‡æ–°éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. ç™»å½• [Zeabur æ§åˆ¶å°](https://dash.zeabur.com/)
2. é€‰æ‹©é¡¹ç›®ï¼š`jiaxiao`
3. ç‚¹å‡»æœåŠ¡ï¼š`web` æˆ–ä¸»æœåŠ¡
4. ç‚¹å‡» "é‡æ–°éƒ¨ç½²" æŒ‰é’®
5. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆ2-3 åˆ†é’Ÿï¼‰
6. æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ï¼Œç¡®è®¤ï¼š
   - ä½¿ç”¨çš„ commit æ˜¯ `a9b5d1f`
   - æ—¥å¿—ä¸­æœ‰ "âœ… æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ"

### æ–¹æ¡ˆ 2: æ£€æŸ¥ Zeabur éƒ¨ç½²é…ç½®

ç¡®è®¤ä»¥ä¸‹è®¾ç½®ï¼š

1. **GitHub é›†æˆ**
   - æ£€æŸ¥æ˜¯å¦è¿æ¥åˆ°æ­£ç¡®çš„ä»“åº“ï¼š`yijoe209-wq/jiaxiao`
   - æ£€æŸ¥åˆ†æ”¯æ˜¯å¦ä¸º `main`
   - æ£€æŸ¥æ˜¯å¦å¯ç”¨è‡ªåŠ¨éƒ¨ç½²

2. **æ„å»ºé…ç½®**
   - æ£€æŸ¥ Dockerfile æˆ–æ„å»ºå‘½ä»¤
   - ç¡®è®¤å®‰è£…äº† requirements.txt ä¸­çš„ä¾èµ–
   - ç¡®è®¤å¯åŠ¨å‘½ä»¤æ­£ç¡®

3. **ç¯å¢ƒå˜é‡**
   - æ£€æŸ¥ `DATABASE_URL` æ˜¯å¦è®¾ç½®
   - å¦‚æœä½¿ç”¨ Zeabur PostgreSQLï¼Œåº”è¯¥è‡ªåŠ¨æ³¨å…¥
   - å¦‚æœä½¿ç”¨ SQLiteï¼Œç¡®ä¿æœ‰æŒä¹…åŒ–å­˜å‚¨

### æ–¹æ¡ˆ 3: æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—

åœ¨ Zeabur æ§åˆ¶å°ï¼š

1. ç‚¹å‡»æœåŠ¡ â†’ æ—¥å¿—
2. æŸ¥çœ‹æœ€è¿‘çš„éƒ¨ç½²æ—¥å¿—
3. æœç´¢å…³é”®è¯ï¼š
   - "âœ… æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ" - è¡¨ç¤ºä¿®å¤å·²åº”ç”¨
   - "Error" æˆ– "Exception" - æŸ¥æ‰¾é”™è¯¯
   - "commit" æˆ– "sha" - ç¡®è®¤ä½¿ç”¨çš„ commit

### æ–¹æ¡ˆ 4: æ£€æŸ¥æ•°æ®åº“è¿æ¥

å¦‚æœ Zeabur PostgreSQL å·²æ·»åŠ ï¼š

```bash
# åœ¨ Zeabur æ§åˆ¶å°æŸ¥çœ‹æ•°æ®åº“ä¿¡æ¯
# åº”è¯¥çœ‹åˆ°ç±»ä¼¼ï¼š
DATABASE_URL=postgresql://postgres:user:password@host:port/dbname
```

ç¡®è®¤ï¼š
- âœ… æ•°æ®åº“æœåŠ¡æ­£åœ¨è¿è¡Œ
- âœ… ç¯å¢ƒå˜é‡å·²æ­£ç¡®æ³¨å…¥
- âœ… åº”ç”¨å¯ä»¥è¿æ¥æ•°æ®åº“

---

## ğŸ“Š éªŒè¯æ­¥éª¤

### æ­¥éª¤ 1: ç­‰å¾… Zeabur é‡æ–°éƒ¨ç½²

æ‰‹åŠ¨è§¦å‘éƒ¨ç½²åï¼Œç­‰å¾… 2-3 åˆ†é’Ÿ

### æ­¥éª¤ 2: æ£€æŸ¥å¥åº·çŠ¶æ€

```bash
curl https://edu-track.zeabur.app/health
```

**é¢„æœŸè¾“å‡º**:
```json
{
  "status": "ok",
  "checks": {
    "database": "ok"
  }
}
```

### æ­¥éª¤ 3: æµ‹è¯•æ³¨å†ŒåŠŸèƒ½

```bash
curl -X POST https://edu-track.zeabur.app/api/register \
  -H "Content-Type: application/json" \
  -d '{"email":"verify_deploy@example.com","password":"test123456","parent_name":"éªŒè¯"}'
```

**é¢„æœŸè¾“å‡º**:
```json
{
  "success": true,
  "family_id": "...",
  "parent_name": "éªŒè¯",
  "message": "æ³¨å†ŒæˆåŠŸ"
}
```

### æ­¥éª¤ 4: è¿è¡Œå®Œæ•´æµ‹è¯•

```bash
python3 simple_test.py
```

---

## ğŸ› å¯èƒ½çš„é—®é¢˜

### é—®é¢˜ 1: Zeabur ä½¿ç”¨ç¼“å­˜çš„ Docker é•œåƒ

**ç—‡çŠ¶**: é‡æ–°éƒ¨ç½²åä»ç„¶ä½¿ç”¨æ—§ä»£ç 

**è§£å†³**:
1. åœ¨ Zeabur è®¾ç½®ä¸­ç¦ç”¨æ„å»ºç¼“å­˜
2. æˆ–è€…åˆ é™¤æœåŠ¡å¹¶é‡æ–°åˆ›å»º
3. æˆ–è€…åœ¨ä»£ç ä¸­æ·»åŠ ä¸€ä¸ªç‰ˆæœ¬å·æ–‡ä»¶æ¥å¼ºåˆ¶é‡å»º

### é—®é¢˜ 2: DATABASE_URL ç¯å¢ƒå˜é‡æœªè®¾ç½®

**ç—‡çŠ¶**: ä½¿ç”¨ SQLite è€Œä¸æ˜¯ PostgreSQL

**è§£å†³**:
1. åœ¨ Zeabur æ§åˆ¶å°æ·»åŠ  PostgreSQL æœåŠ¡
2. ç¡®è®¤ç¯å¢ƒå˜é‡è‡ªåŠ¨æ³¨å…¥
3. æˆ–è€…åœ¨é¢„éƒ¨ç½²è„šæœ¬ä¸­æ‰‹åŠ¨è®¾ç½®

### é—®é¢˜ 3: æ•°æ®åº“æƒé™é—®é¢˜

**ç—‡çŠ¶**: æ— æ³•åˆ›å»ºè¡¨

**è§£å†³**:
1. æ£€æŸ¥ PostgreSQL ç”¨æˆ·æƒé™
2. ç¡®è®¤ç”¨æˆ·æœ‰ CREATE TABLE æƒé™
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²

### é—®é¢˜ 4: åº”ç”¨å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**: æœåŠ¡æ— æ³•å¯åŠ¨

**è§£å†³**:
1. æŸ¥çœ‹å®Œæ•´çš„å¯åŠ¨æ—¥å¿—
2. æ£€æŸ¥ Python é”™è¯¯
3. éªŒè¯æ‰€æœ‰ä¾èµ–å·²å®‰è£…

---

## ğŸ“ ä»£ç ä¿®å¤æ€»ç»“

### ä¿®å¤ 1: PostgreSQL é©±åŠ¨ (commit 6511d8b)

**é—®é¢˜**: SQLAlchemy é»˜è®¤ä½¿ç”¨ `psycopg2`ï¼Œä½† requirements.txt ä½¿ç”¨ `psycopg[binary]`

**ä¿®å¤**:
```python
# models.py:199-210
if database_url.startswith('postgresql://'):
    database_url = database_url.replace('postgresql://', 'postgresql+psycopg://', 1)
```

### ä¿®å¤ 2: æ•°æ®åº“è¡¨è‡ªåŠ¨åˆ›å»º (commit da734cc)

**é—®é¢˜**: åº”ç”¨å¯åŠ¨æ—¶ä¸åˆ›å»ºè¡¨

**ä¿®å¤**:
```python
# models.py:247-255
def init_db(database_url=None):
    global db
    if database_url:
        db = Database(database_url)

    # æ€»æ˜¯åˆ›å»ºè¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
    db.create_tables()  # ğŸ‘ˆ æ–°å¢
    return db
```

### è§¦å‘é‡æ–°éƒ¨ç½² (commit a9b5d1f)

ç©ºçš„æäº¤ï¼Œç”¨äºè§¦å‘ Zeabur é‡æ–°éƒ¨ç½²ï¼š
```bash
git commit --allow-empty -m "trigger: å¼ºåˆ¶è§¦å‘ Zeabur é‡æ–°éƒ¨ç½²"
```

---

## ğŸ¯ å¾…åŠäº‹é¡¹

- [ ] åœ¨ Zeabur æ§åˆ¶å°æ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²
- [ ] ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆ2-3 åˆ†é’Ÿï¼‰
- [ ] æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—ï¼Œç¡®è®¤ä½¿ç”¨äº† commit `a9b5d1f`
- [ ] ç¡®è®¤æ—¥å¿—ä¸­æœ‰ "âœ… æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ"
- [ ] æµ‹è¯•æ³¨å†Œ API
- [ ] è¿è¡Œ `python3 simple_test.py`
- [ ] å¦‚æœæˆåŠŸï¼Œè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ `python3 tests_e2e.py`

---

## ğŸ“ è·å–å¸®åŠ©

### Zeabur æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—](https://zeabur.com/docs/deploy/git)
- [ç¯å¢ƒå˜é‡](https://zeabur.com/docs/environment-variables)
- [é‡æ–°éƒ¨ç½²](https://zeabur.com/docs/advanced/redeploy)

### æœ¬åœ°æµ‹è¯•

å¦‚æœ Zeabur é—®é¢˜æŒç»­ï¼š

1. å¯ä»¥å…ˆåœ¨æœ¬åœ°æµ‹è¯•ï¼š
   ```bash
   python3 app.py
   ```

2. æœ¬åœ°åº”è¯¥ä¼šè‡ªåŠ¨åˆ›å»º `jiaxiao.db`
   ```bash
   ls -l jiaxiao.db
   ```

3. ç¡®è®¤æœ¬åœ°åŠŸèƒ½æ­£å¸¸åï¼Œå†è§£å†³ Zeabur éƒ¨ç½²é—®é¢˜

---

**æœ€åæ›´æ–°**: 2026-01-16 12:50
**çŠ¶æ€**: â³ ç­‰å¾… Zeabur æ‰‹åŠ¨é‡æ–°éƒ¨ç½²
