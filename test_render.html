<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>测试任务渲染</title>
</head>
<body>
    <h1>测试 confirm.html 的 renderTasks 函数</h1>

    <div id="taskList"></div>

    <script>
        // 模拟三种不同的数据结构

        // 1. AI 单任务 (实际数据库中的格式)
        const singleTaskData = {
            type: "single",
            task: {
                type: "single",
                intent: "assignment",
                subject: "语文",
                deadline: null,
                description: "练习古诗二首的默写",
                task_type: "书写",
                details: "练习古诗二首的默写",
                confidence: 0.9,
                raw_text: "练习古诗二首的默写"
            },
            raw_text: "练习古诗二首的默写",
            images: []
        };

        // 2. AI 多任务
        const multipleTaskData = {
            type: "multiple",
            tasks: [
                {
                    description: "完成数学作业第5页",
                    subject: "数学",
                    deadline: null
                },
                {
                    description: "背诵英语课文",
                    subject: "英语",
                    deadline: null
                }
            ],
            images: []
        };

        // 3. 纯图片任务
        const imageOnlyTaskData = {
            type: "single",
            description: "（请查看图片附件）",
            subject: null,
            deadline: null,
            images: ["test.jpg"]
        };

        // 复制 confirm.html 的 renderTasks 函数
        function renderTasks(taskData) {
            const container = document.getElementById('taskList');

            // 处理三种不同的数据结构
            let tasks = [];
            let globalImages = [];

            // 1. AI 多任务
            if (taskData.type === 'multiple' && taskData.tasks) {
                tasks = taskData.tasks;
                globalImages = taskData.images || [];
            }
            // 2. AI 单任务
            else if (taskData.type === 'single' && taskData.task) {
                tasks = [taskData.task];
                globalImages = taskData.images || [];
            }
            // 3. 纯图片任务或旧格式
            else {
                tasks = [taskData];
                globalImages = taskData.images || [];
            }

            if (tasks.length === 0) {
                container.innerHTML = '<div>暂无任务</div>';
                return;
            }

            container.innerHTML = tasks.map((task, index) => {
                // 获取任务描述（兼容多个字段）
                const description = task.description || task.details || task.raw_text || '无描述';
                const subject = task.subject || '未分类';

                return `
                    <div style="border: 1px solid #ccc; padding: 10px; margin: 10px 0;">
                        <h3>任务 ${index + 1}</h3>
                        <p><strong>科目:</strong> ${subject}</p>
                        <p><strong>描述:</strong> ${description}</p>
                    </div>
                `;
            }).join('');
        }

        // 测试三种数据结构
        console.log("测试 1: AI 单任务");
        renderTasks(singleTaskData);
        console.log(document.getElementById('taskList').innerHTML);

        console.log("\n测试 2: AI 多任务");
        renderTasks(multipleTaskData);
        console.log(document.getElementById('taskList').innerHTML);

        console.log("\n测试 3: 纯图片任务");
        renderTasks(imageOnlyTaskData);
        console.log(document.getElementById('taskList').innerHTML);
    </script>
</body>
</html>
